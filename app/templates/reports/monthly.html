{% extends "base.html" %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-6">
        <h2>Monatsbericht</h2>
    </div>
    <div class="col-md-6 text-end">
        <form action="{{ url_for('reports.monthly') }}" method="get" class="d-inline-flex align-items-center">
            <label class="me-2">Monat wählen:</label>
            <input type="month" name="month" value="{{ selected_month }}" class="form-control me-2" style="width: auto;" onchange="this.form.submit()">
            <noscript><button class="btn btn-secondary">Go</button></noscript>
        </form>
    </div>
</div>

<div class="row mb-4">
    <div class="col-12">
        <div class="card bg-primary text-white text-center p-4">
            <h4>Gesamtausgaben im {{ selected_month }}</h4>
            <h1 class="display-3 fw-bold">{{ "%.2f"|format(total_spend) }} €</h1>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                Ausgaben nach Kategorie
            </div>
            <div class="card-body">
                {% if category_breakdown %}
                    {% for name, amount in category_breakdown %}
                        {% set percent = (amount / total_spend * 100)|round|int %}
                        
                        <div class="mb-3">
                            <div class="d-flex justify-content-between">
                                <strong>{{ name }}</strong>
                                <span>{{ "%.2f"|format(amount) }} € ({{ percent }}%)</span>
                            </div>
                            <div class="progress mt-1" style="height: 20px;">
                                <div class="progress-bar bg-info" role="progressbar" style="width: {{ percent }}%;"></div>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p class="text-muted text-center py-4">Keine Daten für diesen Monat gefunden.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}